<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÊâãÊêñÊàêÁôÆÊÇ£ËÄÖËá®Â∫äË®∫Êñ∑Á≥ªÁµ± - Clinical Case Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFCF8;
            background-image: linear-gradient(#E0D8C8 1px, transparent 1px);
            background-size: 100% 28px;
            -webkit-tap-highlight-color: transparent;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
        
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-crown { animation: bounce-slow 2s ease-in-out infinite; }

        @keyframes snowfall-advanced {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            50% { transform: translateY(50vh) translateX(var(--drift)) rotate(180deg); opacity: 1; }
            100% { transform: translateY(110vh) translateX(calc(var(--drift) * 1.5)) rotate(var(--rot)); opacity: 0; }
        }
        .particle {
            position: fixed;
            pointer-events: none;
            z-index: 100;
            animation: snowfall-advanced linear forwards;
        }

        .active-tab { color: white !important; }
        .active-tab i { transform: scale(1.1); stroke-width: 3; }
        
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 0;
            width: 100%;
            position: absolute;
            cursor: pointer;
        }

        /* È†íÁçéÂè∞Ê®£Âºè */
        .podium-container {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 12px;
            padding-top: 20px;
        }
        .podium-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
        }
        .podium-bar {
            width: 70px;
            border-radius: 20px 20px 8px 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 900;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        .podium-bar::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            height: 40%;
            background: rgba(255,255,255,0.2);
            border-radius: 15px 15px 5px 5px;
        }
        .podium-1 .podium-bar { height: 110px; background: #FFB300; }
        .podium-2 .podium-bar { height: 85px; background: #90A4AE; }
        .podium-3 .podium-bar { height: 65px; background: #BCAAA4; }

        /* Èö±ËóèÊç≤Ëª∏ */
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 pb-32">

    <div id="app" class="max-w-2xl mx-auto">
        <!-- Ê®ôÈ°åÂçÄÂüü -->
        <header class="mb-6 text-center pt-2">
            <span class="text-[10px] font-black text-[#6D4C41] tracking-[0.3em] uppercase mb-1 block opacity-70 italic">Clinical Case Report</span>
            <div class="relative inline-block px-8 py-3 bg-white border-2 border-[#4E342E] rounded-2xl shadow-[5px_5px_0px_#D7CCC8] -rotate-1">
                <h1 class="text-2xl font-bold text-[#3E2723]">ÊâãÊêñÊàêÁôÆÊÇ£ËÄÖü•§</h1>
                <div class="absolute -top-3 -right-3 text-amber-500 rotate-12"><i data-lucide="sparkles" size="18"></i></div>
            </div>
        </header>

        <!-- ‰∏ªÂÖßÂÆπÂçÄ -->
        <div id="tab-content"></div>

        <!-- Â∞éË¶ΩÂàó -->
        <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-md bg-[#3E2723] p-2 rounded-[2rem] flex justify-between items-center shadow-2xl z-[110] border border-white/5">
            <button onclick="switchTab('prescribe')" id="btn-prescribe" class="flex-1 flex flex-col items-center py-2 text-[#A1887F] transition-all">
                <i data-lucide="pill" size="20"></i>
                <span class="text-[9px] font-black mt-1 uppercase">Ë®∫Êñ∑ / DX</span>
            </button>
            <button onclick="switchTab('calendar')" id="btn-calendar" class="flex-1 flex flex-col items-center py-2 text-[#A1887F] transition-all">
                <i data-lucide="calendar" size="20"></i>
                <span class="text-[9px] font-black mt-1 uppercase">Êó•Ë™å / Log</span>
            </button>
            <button onclick="switchTab('history')" id="btn-history" class="flex-1 flex flex-col items-center py-2 text-[#A1887F] transition-all">
                <i data-lucide="history" size="20"></i>
                <span class="text-[9px] font-black mt-1 uppercase">Á¥ÄÈåÑ / RX</span>
            </button>
            <button onclick="switchTab('statistics')" id="btn-statistics" class="flex-1 flex flex-col items-center py-2 text-[#A1887F] transition-all">
                <i data-lucide="bar-chart-3" size="20"></i>
                <span class="text-[9px] font-black mt-1 uppercase">ÂàÜÊûê / Stats</span>
            </button>
        </nav>
    </div>

    <script>
        /**
         * ‰øÆÂæ©ÁâàÔºöÊÅ¢Âæ©ËÆÄÂèñÁÄèË¶ΩÂô®ÂÑ≤Â≠òÁ©∫Èñì
         */
        let records = JSON.parse(localStorage.getItem('drink_records')) || [];
        let activeTab = 'prescribe';
        let editingIndex = null;

        // Áï∂ÂâçË°®ÂñÆÊö´Â≠òÁãÄÊÖã
        let currentIce = 'ÂæÆÂÜ∞';
        let currentSugar = 'ÂæÆÁ≥ñ';
        let currentEco = false;
        let currentIns = false;
        
        const getToday = () => {
            const now = new Date();
            const offset = now.getTimezoneOffset() * 60000;
            return new Date(now.getTime() - offset).toISOString().split('T')[0];
        };
        
        let currentDate = getToday();

        function initIcons() {
            lucide.createIcons();
        }

        /**
         * ‰øùÂ≠òÂà∞ localStorage
         */
        function saveRecords() {
            localStorage.setItem('drink_records', JSON.stringify(records));
            render();
        }

        function switchTab(tabId) {
            activeTab = tabId;
            if (activeTab === 'prescribe' && editingIndex === null) {
                resetFormState();
            } else if (activeTab !== 'prescribe') {
                editingIndex = null;
            }
            render();
        }

        function resetFormState() {
            currentIce = 'ÂæÆÂÜ∞';
            currentSugar = 'ÂæÆÁ≥ñ';
            currentEco = false;
            currentIns = false;
            currentDate = getToday();
            editingIndex = null;
        }

        function spawnParticles() {
            const icons = ['pill', 'sparkles', 'flask-conical', 'cup-soda'];
            for(let i=0; i<30; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                const icon = icons[Math.floor(Math.random() * icons.length)];
                p.innerHTML = `<i data-lucide="${icon}" style="color: ${['#e11d48', '#f59e0b', '#0d9488'][i%3]}"></i>`;
                p.style.left = Math.random() * 100 + 'vw';
                p.style.top = '-20px';
                p.style.setProperty('--drift', (Math.random() - 0.5) * 200 + 'px');
                p.style.setProperty('--rot', Math.random() * 720 + 'deg');
                p.style.animationDuration = (Math.random() * 2 + 3) + 's';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 5000);
            }
            initIcons();
        }

        function getStats() {
            const now = new Date();
            const curMonth = now.toISOString().slice(0, 7);
            const monthly = records.filter(r => r.date.startsWith(curMonth));
            const shopCounts = {};
            records.forEach(r => shopCounts[r.shop] = (shopCounts[r.shop] || 0) + 1);
            const sortedShops = Object.entries(shopCounts).sort((a,b) => b[1]-a[1]);

            return {
                mDose: monthly.length,
                mCost: monthly.reduce((acc, r) => acc + (r.insurance ? 0 : parseInt(r.cost || 0)), 0),
                mEco: monthly.filter(r => r.eco).length,
                mIns: monthly.filter(r => r.insurance).length,
                topClinic: sortedShops[0]?.[0] || 'Â∞öÊú™ÁúãË®∫',
                yDose: records.length,
                yCost: records.reduce((acc, r) => acc + (r.insurance ? 0 : parseInt(r.cost || 0)), 0),
                yWaste: records.filter(r => !r.eco).length,
                yIns: records.filter(r => r.insurance).length,
                allShops: sortedShops
            };
        }

        function render() {
            const content = document.getElementById('tab-content');
            const stats = getStats();
            
            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active-tab'));
            const activeBtn = document.getElementById(`btn-${activeTab}`);
            if(activeBtn) activeBtn.classList.add('active-tab');

            if (activeTab === 'prescribe') {
                const isEditing = editingIndex !== null;
                const data = isEditing ? records[editingIndex] : null;

                content.innerHTML = `
                    <div class="space-y-5 animate-fadeIn">
                        <!-- ‰∫îÊ†ºÂç°Áâá -->
                        <section class="grid grid-cols-2 md:grid-cols-5 gap-2">
                            <div class="bg-yellow-100 p-3 rounded-2xl text-center shadow-md border-b-4 border-yellow-200 flex flex-col justify-center min-h-[75px]">
                                <p class="text-[8px] font-black uppercase text-yellow-800/60 leading-tight mb-0.5">Áï∂ÊúàÂäëÈáè</p>
                                <p class="text-[7px] font-bold text-yellow-800/40 uppercase mb-1 tracking-tighter">Monthly Dosage</p>
                                <span class="text-[13px] font-black text-yellow-900">${stats.mDose}ÊùØ</span>
                            </div>
                            <div class="bg-pink-100 p-3 rounded-2xl text-center shadow-md border-b-4 border-pink-200 flex flex-col justify-center min-h-[75px]">
                                <p class="text-[8px] font-black uppercase text-pink-800/60 leading-tight mb-0.5">Ë®∫ÂØüË≤ª</p>
                                <p class="text-[7px] font-bold text-pink-800/40 uppercase mb-1 tracking-tighter">Medical Fee</p>
                                <span class="text-[13px] font-black text-pink-900">$${stats.mCost}</span>
                            </div>
                            <div class="bg-blue-100 p-3 rounded-2xl text-center shadow-md border-b-4 border-blue-200 flex flex-col justify-center min-h-[75px]">
                                <p class="text-[8px] font-black uppercase text-blue-800/60 leading-tight mb-0.5">ÂÅ•‰øùÁî≥Â†±</p>
                                <p class="text-[7px] font-bold text-blue-800/40 uppercase mb-1 tracking-tighter">Insurance</p>
                                <span class="text-[13px] font-black text-blue-900">${stats.mIns}ÊùØ</span>
                            </div>
                            <div class="bg-emerald-100 p-3 rounded-2xl text-center shadow-md border-b-4 border-emerald-200 flex flex-col justify-center min-h-[75px]">
                                <p class="text-[8px] font-black uppercase text-emerald-800/60 leading-tight mb-0.5">Âª¢Ê£ÑÁâ©Ê∏õÂ∞ë</p>
                                <p class="text-[7px] font-bold text-emerald-800/40 uppercase mb-1 tracking-tighter">Waste Reduc.</p>
                                <span class="text-[13px] font-black text-emerald-900">${stats.mEco}‰ª∂</span>
                            </div>
                            <div class="bg-violet-100 p-3 rounded-2xl text-center shadow-md border-b-4 border-violet-200 flex flex-col justify-center min-h-[75px] col-span-2 md:col-span-1">
                                <p class="text-[8px] font-black uppercase text-violet-800/60 leading-tight mb-0.5">ÊúÄÊÑõË®∫ÁôÇÊâÄ</p>
                                <p class="text-[7px] font-bold text-violet-800/40 uppercase mb-1 tracking-tighter">Fav Clinic</p>
                                <span class="text-[11px] font-black text-violet-900 truncate px-1">${stats.topClinic}</span>
                            </div>
                        </section>

                        <!-- ‰∏ªË°®ÂñÆ -->
                        <section class="bg-white rounded-[2.5rem] shadow-xl overflow-hidden border-2 ${isEditing ? 'border-amber-400' : 'border-stone-200'}">
                            <div class="${isEditing ? 'bg-amber-600' : 'bg-[#3E2723]'} p-5 text-white flex justify-between items-center">
                                <div class="flex flex-col">
                                    <p class="text-[10px] font-black opacity-60 tracking-widest mb-1 uppercase">${isEditing ? '‰øÆÊîπÁóÖ‰æã / Update Record' : 'Ëá®Â∫äÁóÖ‰æãË°® / Prescription Form'}</p>
                                    <div class="flex items-center gap-2">
                                        <input type="date" id="input-date" onchange="currentDate=this.value" value="${currentDate}" class="bg-white/10 px-2 py-0.5 rounded-lg font-bold text-lg outline-none text-white border-none cursor-pointer" />
                                        <i data-lucide="clock" size="16"></i>
                                    </div>
                                </div>
                                <i data-lucide="${isEditing ? 'pencil-line' : 'plus-circle'}" class="text-white/80"></i>
                            </div>
                            
                            <div class="p-8 space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="space-y-1.5">
                                        <p class="text-[10px] font-black text-[#3E2723] uppercase">Ë®∫ÁôÇÊâÄ / Clinic</p>
                                        <input type="text" id="input-shop" value="${isEditing ? data.shop : ''}" placeholder="Ë®∫ÊâÄÂêçÁ®±..." class="w-full bg-stone-50 border border-stone-200 p-3 rounded-xl font-bold text-sm outline-none focus:ring-2 focus:ring-[#3E2723] shadow-inner" />
                                    </div>
                                    <div class="space-y-1.5">
                                        <p class="text-[10px] font-black text-[#3E2723] uppercase">Ëó•ÂäëÂêçÁ®± / Drink</p>
                                        <input type="text" id="input-drink" value="${isEditing ? data.drink : ''}" placeholder="Ëó•Ê∞¥ÂêçÁ®±..." class="w-full bg-stone-50 border border-stone-200 p-3 rounded-xl font-bold text-sm outline-none focus:ring-2 focus:ring-[#3E2723] shadow-inner" />
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="space-y-1.5">
                                        <p class="text-[10px] font-black text-[#3E2723] uppercase italic">Ë®∫ÂØüË≤ª / Fee</p>
                                        <input type="number" id="input-cost" value="${isEditing ? data.cost : ''}" placeholder="NT$" class="w-full bg-stone-50 border border-stone-200 p-3 rounded-xl font-bold text-sm outline-none shadow-inner" />
                                    </div>
                                    <div class="md:col-span-2 space-y-2">
                                        <p class="text-[10px] font-black text-[#3E2723] uppercase italic">ÂÜ∞ÈáèË™øÈÖç / Ice</p>
                                        <div class="flex flex-wrap gap-1.5">
                                            ${["Â∏∏Ê∫´", "ÂéªÂÜ∞", "ÂæÆÂÜ∞", "Â∞ëÂÜ∞", "ÂÖ®ÂÜ∞", "ÁÜ±", "ÁÑ°Ê≥ïË™øÊï¥"].map(o => `
                                                <button onclick="setOption('ice', '${o}')" class="px-3 py-2 rounded-xl text-[10px] font-black border transition-all ${currentIce === o ? (o === 'ÁÑ°Ê≥ïË™øÊï¥' ? 'bg-stone-500 text-white border-stone-500 shadow-md' : 'bg-[#3E2723] text-white border-[#3E2723] shadow-md') : 'bg-white text-stone-600 border-stone-200 hover:border-stone-400'}">${o}</button>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-2">
                                    <p class="text-[10px] font-black text-[#3E2723] uppercase italic">Á≥ñÂàÜËó•Âäõ / Sugar</p>
                                    <div class="flex flex-wrap gap-1.5">
                                        ${["ÁÑ°Á≥ñ", "‰∏ÄÂàÜ", "ÂæÆÁ≥ñ", "ÂçäÁ≥ñ", "ÂÖ®Á≥ñ", "ÁÑ°Ê≥ïË™øÊï¥"].map(o => `
                                            <button onclick="setOption('sugar', '${o}')" class="px-3 py-2 rounded-xl text-[10px] font-black border transition-all ${currentSugar === o ? (o === 'ÁÑ°Ê≥ïË™øÊï¥' ? 'bg-stone-500 text-white border-stone-500 shadow-md' : 'bg-[#D84315] text-white border-[#D84315] shadow-md') : 'bg-white text-stone-600 border-stone-200 hover:border-stone-400'}">${o}</button>
                                        `).join('')}
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div class="space-y-2">
                                        <p class="text-[10px] font-black text-[#3E2723] uppercase">Áí∞‰øùÊùØ / Eco</p>
                                        <div class="flex gap-2">
                                            <button onclick="setOption('eco', true)" class="flex-1 py-2 rounded-xl text-[10px] font-black border ${currentEco ? 'bg-emerald-700 text-white border-emerald-700 shadow-md' : 'bg-white text-stone-400 border-stone-200'}">Êúâ</button>
                                            <button onclick="setOption('eco', false)" class="flex-1 py-2 rounded-xl text-[10px] font-black border ${!currentEco ? 'bg-stone-500 text-white border-stone-500 shadow-md' : 'bg-white text-stone-400 border-stone-200'}">ÁÑ°</button>
                                        </div>
                                    </div>
                                    <div class="space-y-2">
                                        <p class="text-[10px] font-black text-[#3E2723] uppercase">ÂÅ•‰øù / Ins</p>
                                        <div class="flex gap-2">
                                            <button onclick="setOption('ins', true)" class="flex-1 py-2 rounded-xl text-[10px] font-black border ${currentIns ? 'bg-blue-700 text-white border-blue-700 shadow-md' : 'bg-white text-stone-400 border-stone-200'}">Êúâ</button>
                                            <button onclick="setOption('ins', false)" class="flex-1 py-2 rounded-xl text-[10px] font-black border ${!currentIns ? 'bg-stone-500 text-white border-stone-500 shadow-md' : 'bg-white text-stone-400 border-stone-200'}">ÁÑ°</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex gap-4 pt-4">
                                    ${isEditing ? `<button onclick="cancelEdit()" class="flex-1 bg-stone-200 text-stone-600 py-4 rounded-2xl font-black text-lg shadow-md">ÂèñÊ∂à</button>` : ''}
                                    <button onclick="saveCurrentRecord()" class="flex-[2] ${isEditing ? 'bg-amber-600' : 'bg-[#3E2723]'} text-white py-4 rounded-2xl font-black text-lg shadow-xl active:scale-95 transition-all border-b-4 border-black/20">
                                        ${isEditing ? 'Á¢∫Ë™ç‰øÆÊîπ / Update' : 'ÈñãÁ´ãËôïÊñπ / Confirm'}
                                    </button>
                                </div>
                            </div>
                        </section>
                    </div>
                `;
            } else if (activeTab === 'history') {
                content.innerHTML = `
                    <div class="space-y-4 animate-fadeIn">
                        <h2 class="text-xl font-black text-[#3E2723] px-2 flex items-center gap-2"><i data-lucide="history" class="text-purple-600"></i> Ë®∫Êñ∑Á¥ÄÈåÑÂ∫´ / RX</h2>
                        ${records.length === 0 ? '<div class="text-center py-20 bg-white rounded-3xl border border-dashed border-stone-300 italic opacity-40 uppercase text-xs">Â∞öÊú™ÊúâÁóÖÊ≠∑Ë≥áÊñô</div>' : records.slice().reverse().map((r, i) => {
                            const realIdx = records.length - 1 - i;
                            return `
                            <div class="bg-white p-5 rounded-[1.8rem] border border-stone-200 shadow-sm flex justify-between items-center group hover:border-[#3E2723] transition-all">
                                <div class="space-y-1">
                                    <div class="flex items-center gap-2">
                                        <span class="text-[9px] font-black text-white bg-[#3E2723] px-2 py-0.5 rounded uppercase">${r.date}</span>
                                        ${r.insurance ? '<span class="bg-blue-100 text-blue-900 text-[8px] px-1.5 py-0.5 rounded font-black">INS</span>' : ''}
                                        ${r.eco ? '<span class="bg-emerald-100 text-emerald-900 text-[8px] px-1.5 py-0.5 rounded font-black">ECO</span>' : ''}
                                    </div>
                                    <h4 class="font-black text-[#3E2723] text-base">${r.shop}</h4>
                                    <p class="text-xs font-bold text-stone-500 tracking-tight">${r.drink} ¬∑ ${r.sugar} ¬∑ ${r.ice}</p>
                                </div>
                                <div class="flex items-center gap-4">
                                    <span class="text-xl font-black text-[#3E2723]">${r.insurance ? 'FREE' : '$'+r.cost}</span>
                                    <div class="flex gap-2">
                                        <button onclick="startEdit(${realIdx})" class="w-10 h-10 bg-stone-100 text-[#3E2723] rounded-full flex items-center justify-center hover:bg-[#3E2723] hover:text-white transition-all shadow-sm">
                                            <i data-lucide="pencil" size="18"></i>
                                        </button>
                                        <button onclick="deleteRecord(${realIdx})" class="w-10 h-10 bg-red-50 text-red-600 rounded-full flex items-center justify-center hover:bg-red-600 hover:text-white transition-all shadow-sm">
                                            <i data-lucide="trash-2" size="18"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                `;
            } else if (activeTab === 'calendar') {
                const now = new Date();
                const curPrefix = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
                content.innerHTML = `
                    <div class="space-y-4 animate-fadeIn">
                        <h2 class="text-xl font-black text-[#3E2723] px-2 flex items-center gap-2"><i data-lucide="calendar" class="text-orange-600"></i> Ë®∫Êñ∑Êó•Ë™å / Log</h2>
                        <div class="bg-white p-6 rounded-[2.5rem] border border-stone-200 shadow-lg">
                             <div class="text-xl font-black text-[#3E2723] mb-6 flex justify-between items-center">
                                <span>${now.getFullYear()}Âπ¥ ${now.getMonth()+1}Êúà</span>
                                <i data-lucide="chevron-right" class="text-stone-300"></i>
                             </div>
                             <div class="grid grid-cols-7 gap-2 text-center text-[9px] font-black text-stone-400 mb-4 uppercase tracking-widest">
                                <span>‰∏Ä</span><span>‰∫å</span><span>‰∏â</span><span>Âõõ</span><span>‰∫î</span><span>ÂÖ≠</span><span>Êó•</span>
                             </div>
                             <div class="grid grid-cols-7 gap-2">
                                ${Array.from({length: 31}).map((_, i) => {
                                    const day = i + 1;
                                    const dStr = `${curPrefix}-${String(day).padStart(2,'0')}`;
                                    const count = records.filter(r => r.date === dStr).length;
                                    let bg = 'bg-stone-50 text-stone-300 border-stone-100';
                                    if(count === 1) bg = 'bg-yellow-100 text-yellow-800 border-yellow-200 shadow-sm';
                                    if(count > 1) bg = 'bg-orange-600 text-white border-orange-800 shadow-md';
                                    return `<div class="aspect-square flex flex-col items-center justify-center rounded-xl text-[11px] font-black border transition-all ${bg}">${day}${count > 0 ? `<span class="text-[7px] mt-0.5">${count}Âäë</span>` : ''}</div>`;
                                }).join('')}
                             </div>
                        </div>
                    </div>
                `;
            } else if (activeTab === 'statistics') {
                const topShops = stats.allShops.slice(0, 5);
                content.innerHTML = `
                    <div class="space-y-6 animate-fadeIn pb-10">
                        <h2 class="text-xl font-black text-[#3E2723] px-2 flex items-center gap-2"><i data-lucide="bar-chart-3" class="text-orange-600"></i> Âπ¥Â∫¶Â§ßÊï∏Êìö / Stats</h2>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-[#1E293B] p-5 rounded-3xl text-white text-center shadow-xl border-b-4 border-black/30">
                                <p class="text-[9px] font-black text-white/40 mb-0.5 uppercase tracking-tighter">Âπ¥Â∫¶Á∏ΩÂäëÈáè</p>
                                <p class="text-[7px] font-bold text-white/20 uppercase mb-1 tracking-tighter">Annual Dosage</p>
                                <span class="text-2xl font-black text-blue-300">${stats.yDose} <small class="text-xs">ÊùØ</small></span>
                            </div>
                            <div class="bg-[#4C1D95] p-5 rounded-3xl text-white text-center shadow-xl border-b-4 border-black/30">
                                <p class="text-[9px] font-black text-white/40 mb-0.5 uppercase tracking-tighter">Âπ¥Â∫¶Á∏ΩËä±Ë≤ª</p>
                                <p class="text-[7px] font-bold text-white/20 uppercase mb-1 tracking-tighter">Annual Spending</p>
                                <span class="text-2xl font-black text-purple-300">$${stats.yCost}</span>
                            </div>
                            <div class="bg-[#7F1D1D] p-5 rounded-3xl text-white text-center shadow-xl border-b-4 border-black/30">
                                <p class="text-[9px] font-black text-white/40 mb-0.5 uppercase tracking-tighter">Âπ¥Â∫¶Âª¢Ê£ÑÁâ©</p>
                                <p class="text-[7px] font-bold text-white/20 uppercase mb-1 tracking-tighter">Waste Impact</p>
                                <span class="text-2xl font-black text-rose-300">${stats.yWaste} <small class="text-xs">ÊùØ</small></span>
                            </div>
                            <div class="bg-[#064E3B] p-5 rounded-3xl text-white text-center shadow-xl border-b-4 border-black/30">
                                <p class="text-[9px] font-black text-white/40 mb-0.5 uppercase tracking-tighter">ÂÅ•‰øùÁ∏ΩÁî≥Â†±</p>
                                <p class="text-[7px] font-bold text-white/20 uppercase mb-1 tracking-tighter">Insurance Total</p>
                                <span class="text-2xl font-black text-emerald-300">${stats.yIns} <small class="text-xs">‰ª∂</small></span>
                            </div>
                        </div>

                        <!-- È†íÁçéÂè∞ -->
                        <section class="bg-white p-6 rounded-[2.5rem] border border-stone-200 shadow-lg">
                            <h3 class="font-black text-[#3E2723] text-xs uppercase tracking-widest text-center mb-2">Âπ¥Â∫¶Ë®∫ÁôÇÊâÄÊéí‰ΩçË≥Ω</h3>
                            <p class="text-center text-[7px] font-black text-stone-300 uppercase tracking-tighter mb-6">Top Drinking Clinic Championship</p>
                            
                            <div class="podium-container mb-10">
                                <div class="podium-item podium-2">
                                    <div class="flex flex-col items-center mb-2">
                                        <div class="w-8 h-8 rounded-full bg-stone-100 flex items-center justify-center mb-1 border-2 border-white shadow-sm">
                                            <i data-lucide="medal" size="14" class="text-stone-400"></i>
                                        </div>
                                        <span class="text-[9px] font-black text-stone-500 truncate max-w-[70px]">${topShops[1]?.[0] || '-'}</span>
                                    </div>
                                    <div class="podium-bar">2</div>
                                </div>
                                <div class="podium-item podium-1">
                                    <div class="flex flex-col items-center mb-2">
                                        <div class="animate-crown mb-1">
                                            <i data-lucide="crown" size="24" class="text-amber-500 fill-amber-500"></i>
                                        </div>
                                        <span class="text-[10px] font-black text-[#3E2723] truncate max-w-[90px]">${topShops[0]?.[0] || '-'}</span>
                                    </div>
                                    <div class="podium-bar">1</div>
                                </div>
                                <div class="podium-item podium-3">
                                    <div class="flex flex-col items-center mb-2">
                                        <div class="w-8 h-8 rounded-full bg-stone-100 flex items-center justify-center mb-1 border-2 border-white shadow-sm">
                                            <i data-lucide="award" size="14" class="text-orange-300"></i>
                                        </div>
                                        <span class="text-[9px] font-black text-stone-500 truncate max-w-[70px]">${topShops[2]?.[0] || '-'}</span>
                                    </div>
                                    <div class="podium-bar">3</div>
                                </div>
                            </div>
                            
                            <div class="space-y-4 pt-4 border-t border-stone-100">
                                ${topShops.length === 0 ? '<p class="text-center text-stone-400 italic text-[10px] py-4 uppercase">ÁõÆÂâçÂ∞öÁÑ°Ë®∫Êñ∑Á¥ÄÈåÑ</p>' : topShops.map(([name, count], idx) => {
                                    const maxCount = topShops[0][1];
                                    const percent = (count / maxCount) * 100;
                                    return `
                                    <div class="flex items-center gap-3">
                                        <div class="flex-1">
                                            <div class="flex justify-between text-[10px] font-black text-stone-600 mb-1">
                                                <span class="truncate max-w-[150px]">${idx+1}. ${name}</span>
                                                <span class="text-[9px] opacity-60">${count} Ê¨°</span>
                                            </div>
                                            <div class="w-full bg-stone-50 h-2.5 rounded-full overflow-hidden border border-stone-100 p-0.5">
                                                <div class="h-full bg-gradient-to-r from-[#4E342E] to-[#3E2723] rounded-full transition-all duration-1000" style="width: ${percent}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                `}).join('')}
                            </div>
                        </section>
                    </div>
                `;
            }
            initIcons();
        }

        // ‰øÆÊîπËàá‰øùÂ≠òÂäüËÉΩ
        function startEdit(index) {
            editingIndex = index;
            const data = records[index];
            currentIce = data.ice;
            currentSugar = data.sugar;
            currentEco = data.eco;
            currentIns = data.insurance;
            currentDate = data.date;
            activeTab = 'prescribe';
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteRecord(index) {
            // Ëá™ÂÆöÁæ©Á¢∫Ë™çÂ∞çË©±Ê°Ü
            const isConfirmed = confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠ÜÁóÖ‰æãÁ¥ÄÈåÑÂóéÔºü');
            if (isConfirmed) {
                records.splice(index, 1);
                saveRecords();
            }
        }

        function cancelEdit() {
            resetFormState();
            render();
        }

        function setOption(type, val) {
            if(type === 'ice') currentIce = val;
            if(type === 'sugar') currentSugar = val;
            if(type === 'eco') currentEco = val;
            if(type === 'ins') currentIns = val;
            render();
        }

        function saveCurrentRecord() {
            const shop = document.getElementById('input-shop').value.trim();
            const drink = document.getElementById('input-drink').value.trim();
            const cost = document.getElementById('input-cost').value || 0;
            const date = currentDate;

            if(!shop || !drink) { 
                const msg = document.createElement('div');
                msg.className = 'fixed top-10 left-1/2 -translate-x-1/2 bg-red-600 text-white px-6 py-3 rounded-2xl font-bold shadow-2xl z-[200] animate-fadeIn';
                msg.innerText = 'Ë´ãÂÆåÊï¥Â°´ÂØ´Â∫óÂêçËàáÈ£≤ÂìÅÔºÅ';
                document.body.appendChild(msg);
                setTimeout(() => msg.remove(), 2000);
                return; 
            }

            const entry = { 
                date, shop, drink, 
                cost: parseInt(cost), 
                ice: currentIce, 
                sugar: currentSugar, 
                eco: currentEco, 
                insurance: currentIns 
            };

            if (editingIndex !== null) {
                records[editingIndex] = entry;
                editingIndex = null;
            } else {
                records.push(entry);
                spawnParticles();
            }

            saveRecords();
            resetFormState();
            switchTab('history');
        }

        /**
         * ÂàùÂßãÂä†Ëºâ
         */
        window.onload = () => {
            render();
        };
    </script>
</body>
</html>

